!function(){"use strict";const t=(t,n)=>t.querySelector(`[data-key="${n}"]`);function n(t,n){t.style.transform=`translate(${n.x}px, ${n.y}px)`}const e=(t,...n)=>t?.classList.add(...n),o=(t,n)=>t?.classList.remove(n),i=(t,n)=>t?.classList.contains(n);function a(t,n,i,a){n.styles||(n.styles=[]);const s=n.styles.findIndex((t=>t.startsWith(i)));s>-1&&(o(t,n.styles[s]),n.styles.splice(s,1)),n.styles.push(a),e(t,a)}const s=(t,n,e,o)=>t.addEventListener(n,e,{passive:!0,once:o}),c=(t,n,e,o)=>t?.removeEventListener(n,e,{capture:o});function r(t,n,e){t.querySelectorAll(n).forEach((t=>{t.onclick=e}))}const d=(t,n)=>t.currentTarget.getAttribute(n);function l(t,n){const e=document.createElementNS("http://www.w3.org/2000/svg",t);return n&&(e.innerHTML=n),e}function h(t){let n,e=0;for(const o of t.getElementsByTagName("tspan"))for(const t of u(o.getBBox())){const o=Math.abs(t.x)+Math.abs(t.y);e<o&&(n=t,e=o)}return n}const u=t=>[{x:t.x,y:t.y},{x:t.right,y:t.y},{x:t.x,y:t.bottom},{x:t.right,y:t.bottom}];function p(t,n,e){return e<=t?t:t+Math.ceil((e-t)/n)*n}function f(t,n){let e=t.pop();for(;e;)n(e),e=t.pop()}function v(t,n,e){const o=e??1;return t.x+=o*n.x,t.y+=o*n.y,t}const m=t=>JSON.parse(JSON.stringify(t));const g=Symbol("movementX"),x=Symbol("movementY"),y=Symbol("Canvas");function w(t,n,e,o,i,a,r,d,l){let h,u=!1,p=!1;function f(t){p&&(u||(i(t),p))&&(k(o,e.scale,t),u=!0,a(t))}function v(t){u?r(t):d(t),x(!0)}function m(t){n.contains(t.target)||(x(),l())}function g(){x(),l()}function x(n){c(h,"pointercancel",v),c(h,"pointerup",v),c(h,"pointermove",f),n||(c(t,"pointerdown",m),c(t,"wheel",g)),h=null,u=!1,p=!1}return s(n,"pointerdown",(function(n){!n[M]&&n.isPrimary&&(n[M]=!0,h=n.target,n.pointerId!==b&&h.setPointerCapture(n.pointerId),s(h,"pointercancel",v,!0),s(h,"pointerup",v,!0),s(h,"pointermove",f),s(t,"wheel",g,!0),s(t,"pointerdown",m),p=!0)})),x}function k(t,n,e){t.x+=e[g]/n,t.y+=e[x]/n}const b=42;function $(t){t.ownerSVGElement.focus(),t.dispatchEvent(new PointerEvent("pointerdown",{isPrimary:!0,pointerId:b})),t.dispatchEvent(new PointerEvent("pointerup",{isPrimary:!0}))}const M=Symbol("processed"),H=(t,n,e)=>({x:(n-t.position.x)/t.scale,y:(e-t.position.y)/t.scale});function z(t,n){const e=n/2;function o(t){const o=Math.round(t/n)*n;return t-o>0?o+e:o-e}t.x=o(t.x),t.y=o(t.y)}function L(t){return{x:t.clientX,y:t.clientY}}function E(t,n){return{id:t.pointerId,pos:L(t),shift:{x:n.position.x-t.clientX,y:n.position.y-t.clientY}}}function V(t){return B(t)[0]}function B(t){return document.elementsFromPoint(t.clientX,t.clientY).sort(((t,n)=>{const e=t.getAttribute("data-evt-index"),o=n.getAttribute("data-evt-index");return e===o?0:e>o?-1:1}))}const S=Symbol("routeed");let C;function P(t){t&&!C?(C=document.createElement("div"),C.style.cssText="z-index: 2; position: fixed; left: 0; top: 0; width:100%; height:100%; background: #fff; opacity: 0",C.innerHTML="<style>@keyframes blnk{0%{opacity:0}50%{opacity:.7}100%{opacity:0}}.blnk{animation:blnk 1.6s linear infinite}</style>",C.classList.add("blnk"),document.body.append(C)):t||(C.remove(),C=null)}function A(t){document.getElementById("diagram").style.pointerEvents=t?"none":"unset",document.getElementById("tip").style.display=t?"unset":"none"}const T=Symbol("path"),O=Symbol("shape");function j(t){t[y].selectClear&&t[y].selectClear()}function N(t,n){t[y].selectClear=n}function Z(t,n,e){if("1.1"!==n.v)return alert("Wrong format"),null;e||function(t){for(;t.firstChild;)(t.firstChild[O]||t.firstChild[T]).del();t[y].move(0,0,1)}(t);const o=new Map;function i(n){let e=o.get(n);return e||(e=t[y].shapeMap[n.type].create(n),t.append(e),o.set(n,e)),e}const a=[];for(const e of n.s)switch(e.type){case 0:{const o=t=>{return t.p?{data:t.p}:{shape:{shapeEl:(e=t.s,i(n.s[e])),connectorKey:t.k}};var e},s=t[y].shapeMap[0].create({styles:e.c,s:o(e.s),e:o(e.e)});a.push(s),t.append(s);break}default:i(e)}return[...o.values(),...a]}const I='<svg data-cmd="del" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z" fill="rgb(52,71,103)"/></svg>',J='<svg data-cmd="copy" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7 6V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1.001 1.001 0 0 1 3 21l.003-14c0-.552.45-1 1.007-1H7zM5.003 8L5 20h10V8H5.003zM9 6h8v10h2V4H9v2z" fill="rgb(52,71,103)"/></svg>';class D extends HTMLElement{constructor(t){super(),this.o=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px}[data-cmd]{cursor:pointer}</style><div class="ln">${J} ${I}</div>`,r(t,"[data-cmd]",(t=>this.o(d(t,"data-cmd"))))}}let K;function F(t,n,e){function o(t,n){K.style.left=`${t}px`,K.style.top=window.scrollY+n-K.getBoundingClientRect().height+"px"}return K=document.createElement("div"),K.style.cssText="position: fixed; box-shadow: 0px 0px 58px 2px rgb(34 60 80 / 20%); border-radius: 16px; background-color: rgba(255,255,255, .9);",K.append(e),document.body.append(K),o(t,n),{position:o,del:()=>{K.remove(),K=null}}}function R(t,n){const e=H(t[y].data,window.innerWidth/2,window.innerHeight/2);z(e,t[y].data.cell);const o=v(e,function(t){const n=function(t){const n={x:1/0,y:1/0},e={x:-1/0,y:-1/0};return X(t,(t=>{t&&(n.x>t.x&&(n.x=t.x),n.y>t.y&&(n.y=t.y),e.x<t.x&&(e.x=t.x),e.y<t.y&&(e.y=t.y))})),{min:n,max:e}}(t);return{x:n.min.x+(n.max.x-n.min.x)/2,y:n.min.y+(n.max.y-n.min.y)/2}}(n),-1);X(n,(t=>{t&&v(t,o)}))}function X(t,n){t.s.forEach((t=>{0===t.type?(n(t.s.p?.position),n(t.e.p?.position)):n(t.position)}))}customElements.define("ap-grp-settings",D);const Y="dgrm";function _(t){function n(n){const e=t();document.activeElement===e[0].ownerSVGElement&&(n.preventDefault(),n.clipboardData.setData(Y,JSON.stringify(U(e))))}return document.addEventListener("copy",n),function(){c(document,"copy",n)}}const q=(t,n)=>W(t,U(n)),U=t=>m(function(t){const n={v:"1.1",s:[]};for(const e of t)if(e[O])n.s.push(e[O].data);else{function o(n){const e=t.indexOf(n.shape?.shapeEl);return-1!==e?{s:e,k:n.shape.connectorKey}:{p:n.data}}const i=e[T].data,a={type:0,s:o(i.s),e:o(i.e)};i.styles&&(a.c=i.styles),n.s.push(a)}return n}(t));function W(t,n){j(t),R(t,n),nt(t,Z(t,n,!0))}const G="highlight-s",Q="highlight-e",tt="highlight";function nt(t,n,i){const a=t=>!i||i(t.position),r={shapes:[],shapesPaths:[],pathEnds:[],pathEndsPaths:[]};function d(t,n,o){return!n.shape&&a(n.data)?(r.pathEnds.push(n),e(t,o),1):n.shape&&a(n.shape.shapeEl[O].data)?2:0}for(const t of n)if(t[O])a(t[O].data)&&(e(t,tt),r.shapes.push(t));else if(t[T]){const n=d(t,t[T].data.s,G),e=d(t,t[T].data.e,Q);1!==n&&1!==e||r.pathEndsPaths.push(t),2!==n&&2!==e||r.shapesPaths.push(t)}!function(t,n){if(1===n.shapes?.length&&!n.pathEnds?.length)return o(n.shapes[0],"highlight"),void $(n.shapes[0]);if(!n.shapes?.length&&1===n.pathEnds?.length)return void ot(n.pathEndsPaths[0]);if(!n.shapes?.length&&2===n.pathEnds?.length&&1===n.pathEndsPaths?.length)return ot(n.pathEndsPaths[0]),void $(n.pathEndsPaths[0]);const e=t.ownerSVGElement;let i,a=!1,r=!1;const d=()=>{i?.del(),i=null};function l(t){d(),r=n.shapes?.some((n=>n.contains(t.target)))||n.pathEnds?.some((n=>n.el.contains(t.target))),r||t.target===e?(r&&t.stopImmediatePropagation(),e.setPointerCapture(t.pointerId),s(e,"pointerup",u,!0),s(e,"pointermove",p)):v()}function h(t){n.shapes?.forEach((n=>{t(n[O].data.position),n[O].drawPosition()})),n.pathEnds?.forEach((n=>t(n.data.position))),n.pathEndsPaths?.forEach((t=>t[T].draw()))}function u(e){if(a)h((n=>z(n,t[y].data.cell)));else{if(!r)return void v();i=F(e.clientX-10,e.clientY-10,new D((e=>{switch(e){case"del":f(n.shapes,(t=>t[O].del())),f(n.pathEndsPaths,(t=>t[T].del())),v();break;case"copy":q(t,et(n))}})))}v(!0)}function p(n){r?(a=!0,h((e=>k(e,t[y].data.scale,n)))):v(!0)}function v(i){c(e,"pointerup",u),c(e,"pointermove",p),a=!1,r=!1,i||(N(t,null),m&&(m(),m=null),c(e,"pointerdown",l,!0),d(),f(n.shapes,(t=>o(t,tt))),f(n.pathEndsPaths,(t=>ot(t))),n.pathEnds=null,n.shapesPaths=null)}e.addEventListener("pointerdown",l,{passive:!0,capture:!0}),N(t,v);let m=_((()=>et(n)))}(t,r)}function et(t){const n=new Set,e=n=>t.shapes.includes(n.shape?.shapeEl)||t.pathEnds.includes(n);function o(t){e(t[T].data.s)&&e(t[T].data.e)&&n.add(t)}return t.shapesPaths?.forEach(o),t.pathEndsPaths?.forEach(o),[...t.shapes,...n]}function ot(t){o(t,G),o(t,Q)}const it=(t,n,e,o,i)=>t.x<=o&&o<=t.x+n&&t.y<=i&&i<=t.y+e;class at extends HTMLElement{constructor(t,n){super(),this.i=n,this.u=t}connectedCallback(){const t=this.i[T].data.styles,n=t=>this.i[T].data.styles?.includes(t)?'class="actv"':"",i=this.attachShadow({mode:"closed"});i.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px;fill-opacity:.3;stroke-opacity:.3}[data-cmd]{cursor:pointer}.actv{fill-opacity:1;stroke-opacity:1}</style><ap-shape-edit id="edit" edit-btn="true"><div class="ln"><svg data-cmd data-cmd-arg="arw-s" ${n("arw-s")} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="arw-e" ${n("arw-e")} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="dash" ${n("dash")} viewBox="0 0 24 24" width="24" height="24"><path d="M 2,11 L 20,11" stroke="rgb(52,71,103)" style="stroke-dasharray:4,3;stroke-width:3"></path></svg></div></ap-shape-edit>`,s(i.getElementById("edit"),"cmd",(t=>{switch(t.detail.cmd){case"style":a(this.i,this.i[T].data,"cl-",t.detail.arg);break;case"del":this.i[T].del();break;case"copy":q(this.u,[this.i])}})),r(i,"[data-cmd]",(n=>{const i=d(n,"data-cmd-arg"),a=t.indexOf(i);a>-1?(o(this.i,i),t.splice(a,1),o(n.currentTarget,"actv")):(e(this.i,i),t.push(i),e(n.currentTarget,"actv"))}))}}function st(n,a){const r=l("g",'<path data-key="outer" d="M0 0" stroke="transparent" stroke-width="20" fill="none"/><path data-key="path" class="path" d="M0 0" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"/><path data-key="selected" d="M0 0" stroke="transparent" stroke-width="10" fill="none" style="pointer-events:none"/><g data-key="start"><circle data-evt-index="1" class="path-end" r="10" stroke-width="0" fill="transparent"/><path class="path" d="M-7 7 l 7 -7 l -7 -7" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"></path></g><g data-key="end"><circle data-evt-index="1" class="path-end" r="10" stroke-width="0" fill="transparent"/><path class="path" d="M-7 7 l 7 -7 l -7 -7" stroke="#495057" stroke-width="1.8" fill="none" style="pointer-events:none"></path></g>');e(r,"shpath"),a.s.el=t(r,"start"),a.e.el=t(r,"end"),a.styles=a.styles??["arw-e"];const d=pt(r,"path","outer","selected");function h(){if(!a.s.shape||!a.e.shape){const t=function(t,n){const e=Math.atan2(n.y-t.y,n.x-t.x);return ft(e,-.8,.8)?"left":ft(e,.8,2.4)?"top":ft(e,2.4,3.2)||ft(e,-3.2,-2.4)?"right":"bottom"}(a.s.data.position,a.e.data.position);a.e.shape||(a.e.data.dir=t),a.s.shape||(a.s.data.dir=ut(t))}const t=function(t){let n=.5*Math.hypot(t.s.data.position.x-t.e.data.position.x,t.s.data.position.y-t.e.data.position.y);function e(t){return"right"===t.dir||"left"===t.dir?"right"===t.dir?t.position.x+n:t.position.x-n:t.position.x}function o(t){return"right"===t.dir||"left"===t.dir?t.position.y:"bottom"===t.dir?t.position.y+n:t.position.y-n}return n=n>70?70:n<15?15:n,`M ${t.s.data.position.x} ${t.s.data.position.y} C ${e(t.s.data)} ${o(t.s.data)}, ${e(t.e.data)} ${o(t.e.data)}, ${t.e.data.position.x} ${t.e.data.position.y}`}(a);d.forEach((n=>n.setAttribute("d",t))),dt(a.s),dt(a.e)}function u(t){rt(t.shape)?.pathDel(r)}function p(t){t.shape&&(t.data=rt(t.shape).pathAdd(t.shape.connectorKey,r))}let f;let v,m,g,x=0;function b(){x=0,o(r,"select"),lt(a.s,1),lt(a.e,1),f?.del(),f=null,m&&(m(),m=null,r.style.pointerEvents="unset"),N(n,null),v&&(v(),v=null)}const $=w(n.ownerSVGElement,r,n[y].data,{get x(){return a[g]?.data.position.x},set x(t){g&&(a[g].data.position.x=t)},get y(){return a[g]?.data.position.y},set y(t){g&&(a[g].data.position.y=t)}},(t=>{b(),g=a.e.el.contains(t.target)?"e":a.s.el.contains(t.target)?"s":null,g&&(a[g].shape&&(a[g].shape.shapeEl!==a["s"===g?"e":"s"].shape?.shapeEl&&u(a[g]),a[g].shape=null,a[g].data={dir:a[g].data.dir,position:H(n[y].data,t.clientX,t.clientY)}),r.style.pointerEvents="none",m=function(t){let n=null;function a(t){const a=V(t);if(n!==a){i(a,"hovertrack")&&e(a,"hover");let t=!1;i(a?.parentElement,"hovertrack")&&(e(a.parentElement,"hover"),t=!0),o(n,"hover"),n?.parentElement===a?.parentElement&&t||o(n?.parentElement,"hover"),n=a}}return s(t,"pointermove",a),function(){c(t,"pointermove",a),o(n,"hover"),o(n?.parentElement,"hover"),n=null}}(r.parentElement))}),(t=>{g?h():function(t,n,e,o){const i=n=>k(n,t.scale,o);ct(n.s,i),ct(n.e,i),n.s.shape||n.e.shape||e()}(n[y].data,a,h,t)}),(t=>{if(g){const e=V(t),o=e?.getAttribute("data-connect");o?(a[g].shape={shapeEl:e.parentElement,connectorKey:o},p(a[g])):z(a[g].data.position,n[y].data.cell),h()}else!function(t,n,e){const o=n=>z(n,t.cell);ct(n.s,o),ct(n.e,o),n.s.shape&&n.e.shape||e()}(n[y].data,a,h);b()}),(function(t){if(2!==x){if(1===x)return x=2,void(f=F(t.clientX-10,t.clientY-10,new at(n,r)));x=1,e(r,"select"),lt(a.s,2),lt(a.e,2),N(n,b),v=_((()=>[r]))}}),b);return r[T]={draw:h,pointerCapture:t=>a.e.el.dispatchEvent(new PointerEvent("pointerdown",t)),del:function(){b(),$(),u(a.s),u(a.e),r.remove()},data:a},a.styles&&e(r,...a.styles),p(a.s),p(a.e),h(),r}function ct(t,n){t.shape?(n(rt(t.shape).data.position),rt(t.shape).drawPosition()):n(t.data.position)}customElements.define("ap-path-settings",at);const rt=t=>t?.shapeEl[O];function dt(t){t.el.style.transform=`translate(${t.data.position.x}px, ${t.data.position.y}px) rotate(${ht(t.data.dir)}deg)`}function lt(t,n){t.el.firstElementChild.setAttribute("data-evt-index",n.toString())}const ht=t=>"right"===t?180:"left"===t?0:"bottom"===t?270:90,ut=t=>"left"===t?"right":"right"===t?"left":"top"===t?"bottom":"top";const pt=(n,...e)=>e.map((e=>t(n,e))),ft=(t,n,e)=>n<=t&&t<=e;function vt(t,n,e){const o=function(t,n){let e=0;return{s:t.split("\n").map(((t,o)=>(e=o,`<tspan x="${n}" dy="${0===o?.41:1}em" ${0===t.length?'visibility="hidden"':""}>${0===t.length?".":function(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}(t).replaceAll(" ","&nbsp;")}</tspan>`))).join(""),c:e}}(e||"",t.x?.baseVal[0]?.value??0);t.innerHTML=o.s,t.y.baseVal[0].newValueSpecifiedUnits(t.y.baseVal[0].SVG_LENGTHTYPE_EMS,o.c>0?n-o.c/2:n)}function mt(t,n,e,o){const i=new gt;return s(i,"cmd",(e=>{switch(e.detail.cmd){case"style":a(n,n[O].data,"cl-",e.detail.arg);break;case"del":n[O].del();break;case"copy":q(t,[n])}})),F(e,o,i)}class gt extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML=`<style>.ln{display:flex}.ln>*{height:24px;padding:10px;cursor:pointer}#prop{padding-bottom:10px}.crcl{width:25px;height:25px;border-radius:50%}</style><div id="pnl"><div id="clr" style="display:none"><div class="ln"><div data-cmd="style" data-cmd-arg="cl-red"><div class="crcl" style="background:#e74c3c"></div></div><div data-cmd="style" data-cmd-arg="cl-orange"><div class="crcl" style="background:#f60"></div></div><div data-cmd="style" data-cmd-arg="cl-green"><div class="crcl" style="background:#19bc9b"></div></div></div><div class="ln"><div data-cmd="style" data-cmd-arg="cl-blue"><div class="crcl" style="background:#1aaee5"></div></div><div data-cmd="style" data-cmd-arg="cl-dblue"><div class="crcl" style="background:#1d809f"></div></div><div data-cmd="style" data-cmd-arg="cl-dgray"><div class="crcl" style="background:#495057"></div></div></div></div><div id="prop" style="display:none"><slot id="slot"></slot></div></div><div class="ln"><svg data-toggle="clr" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M19.228 18.732l1.768-1.768 1.767 1.768a2.5 2.5 0 1 1-3.535 0zM8.878 1.08l11.314 11.313a1 1 0 0 1 0 1.415l-8.485 8.485a1 1 0 0 1-1.414 0l-8.485-8.485a1 1 0 0 1 0-1.415l7.778-7.778-2.122-2.121L8.88 1.08zM11 6.03L3.929 13.1 11 20.173l7.071-7.071L11 6.029z" fill="rgb(52,71,103)"/></svg> <svg data-toggle="prop" ${this.getAttribute("edit-btn")?"":'style="display: none;"'} viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12.9 6.858l4.242 4.243L7.242 21H3v-4.243l9.9-9.9zm1.414-1.414l2.121-2.122a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414l-2.122 2.121-4.242-4.242z" fill="rgb(52,71,103)"/></svg> ${J} ${I}</div>`;{const n=t.getElementById("pnl");function e(t){var e;e=window.scrollY+t*n.getBoundingClientRect().height,K.style.top=`${K.getBoundingClientRect().top+e}px`}let o;r(t,"[data-toggle]",(n=>{o&&(e(1),xt(o,!1));const i=t.getElementById(d(n,"data-toggle"));o!==i?(xt(i,!0),e(-1),o=i):o=null}))}r(t,"[data-cmd]",(t=>{this.dispatchEvent(new CustomEvent("cmd",{detail:{cmd:d(t,"data-cmd"),arg:d(t,"data-cmd-arg")}}))}))}}function xt(t,n){t.style.display=n?"unset":"none"}function yt(n,i,a,s,c,r){const d=l("g",`${a}\n\t\t${Object.entries(s).map((t=>`<circle data-key="${t[0]}" data-connect="${t[1].dir}" class="hovertrack" data-evt-index="2" r="10" cx="0" cy="0" style="transform:translate(${t[1].position.x}px,${t[1].position.y}px)"/>`)).join()}`),h={el:t(d,"text"),vMid:0};vt(h.el,h.vMid,i.title);const u=function(t,n,i,a,s,c,r){let d,h;function u(){d?.dispose(),d=null,h?.del(),h=null}function p(t){i.title=t,r()}const f=c??mt,v=function(t,n,i,a,s,c){e(n,"hovertrack");const r=m(a),d=new Set;function l(){n.style.transform=`translate(${i.position.x}px, ${i.position.y}px)`;for(const t in a)r[t].position={x:a[t].position.x+i.position.x,y:a[t].position.y+i.position.y};for(const t of d)t[T].draw()}let h,u=0;function p(){c(),u=0,o(n,"select"),o(n,"highlight"),N(t,null),h&&(h(),h=null)}const f=w(t.ownerSVGElement,n,t[y].data,i.position,(e=>{p();const o=e.target.getAttribute("data-connect");if(o){f();const i=st(t,{s:{shape:{shapeEl:n,connectorKey:o}},e:{data:{dir:ut(r[o].dir),position:H(t[y].data,e.clientX,e.clientY)}}});n.parentNode.append(i),i[T].pointerCapture(e),d.add(i)}}),l,(n=>{z(i.position,t[y].data.cell),l()}),(i=>{if(2!==u){if(1===u)return u=2,o(n,"select"),e(n,"highlight"),void s();u=1,e(n,"select"),N(t,p),h=_((()=>[n]))}}),p);return n[O]={pathAdd:function(t,n){return d.add(n),r[t]},pathDel:function(t){d.delete(t)},drawPosition:l,data:i},{drawPosition:l,del:()=>{p(),f();for(const t of d)t[T].del()}}}(t,n,i,a,(()=>{d=function(t,n,e,o,i){let a=l("foreignObject");const s=document.createElement("textarea"),c=()=>function(t,n,e,o,i){const a=t.getBBox(),s=a.width+20;n.width.baseVal.value=s+2*o+2,n.x.baseVal.value=a.x-o-("center"===i?10:"right"===i?20:0),n.height.baseVal.value=a.height+2*o+3,n.y.baseVal.value=a.y-o,e.style.width=`${s}px`,e.style.height=`${a.height}px`}(t,a,s,d,r.textAlign);s.value=e||"",s.oninput=function(){vt(t,n,s.value),o(s.value),c()},s.onblur=function(){i(s.value)},s.onpointerdown=function(t){t.stopImmediatePropagation()},a.appendChild(s),t.parentElement.appendChild(a);const r=getComputedStyle(s),d=parseInt(r.paddingLeft)+parseInt(r.borderWidth);return c(),s.focus(),{dispose:()=>{a.remove(),a=null},draw:c}}(s.el,s.vMid,i.title,p,p);const e=n.getBoundingClientRect();h=f(t,n,e.left+10,e.top+10)}),u);i.styles&&e(n,...i.styles);return n[O].del=function(){v.del(),n.remove()},{draw:()=>{if(v.drawPosition(),h){const t=n.getBoundingClientRect();h.position(t.left+10,t.top+10)}d&&d.draw()}}}(n,d,i,s,h,r,(()=>c(h.el)));return{el:d,cons:s,draw:u.draw}}function wt(e,o){const i=yt(e,o,'<circle data-key="outer" data-evt-no data-evt-index="2" r="72" fill="transparent" stroke-width="0"/><circle data-key="main" r="48" fill="#ff6600" stroke="#fff" stroke-width="1"/><text data-key="text" x="0" y="0" text-anchor="middle" style="pointer-events:none" fill="#fff"> </text>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},(t=>{const n=function(t,n,e){const o=h(t);return p(n,e,Math.sqrt(o.x**2+o.y**2))}(t,48,24);n!==o.r&&(o.r=n,a())}));function a(){i.cons.right.position.x=o.r,i.cons.left.position.x=-o.r,i.cons.bottom.position.y=o.r,i.cons.top.position.y=-o.r;for(const e in i.cons)n(t(i.el,e),i.cons[e].position);kt(i.el,"outer",o.r+24),kt(i.el,"main",o.r),i.draw()}return o.r&&48!==o.r?a():i.draw(),i.el}function kt(n,e,o){t(n,e).r.baseVal.value=o}customElements.define("ap-shape-edit",gt);const bt=(t,n,e,o)=>F(e,o,new $t(t,n));class $t extends HTMLElement{constructor(t,n){super(),this.m=n,this.u=t}connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.ln{display:flex}.ln>*{height:24px;padding:10px;fill-opacity:.3;stroke-opacity:.3}[data-cmd]{cursor:pointer}.ta-1 [data-cmd-arg="1"],.ta-2 [data-cmd-arg="2"],.ta-3 [data-cmd-arg="3"]{fill-opacity:1;stroke-opacity:1}</style><ap-shape-edit id="edit" edit-btn="true"><div class="ln"><svg data-cmd data-cmd-arg="1" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="2" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z" fill="rgb(52,71,103)"/></svg> <svg data-cmd data-cmd-arg="3" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z" fill="rgb(52,71,103)"/></svg></div></ap-shape-edit>';const n=this.m[O].data,i=t.getElementById("edit");e(i,`ta-${n.a}`),s(i,"cmd",(t=>{switch(t.detail.cmd){case"style":a(this.m,n,"cl-",t.detail.arg);break;case"del":this.m[O].del();break;case"copy":q(this.u,[this.m])}})),r(t,"[data-cmd]",(t=>{const a=Number.parseInt(d(t,"data-cmd-arg"));if(a===n.a)return;const s=n.a;n.a=a,this.m[O].draw(),o(i,`ta-${s}`),e(i,`ta-${n.a}`)}))}}function Mt(i,a){a.w=a.w??96,a.h=a.h??48,a.a=a.a??(a.t?1:2);const s=`\n\t\t<rect data-key="outer" data-evt-no data-evt-index="2" width="144" height="96" x="-72" y="-48" fill="transparent" stroke="transparent" stroke-width="0" />\n\t\t<rect data-key="main" width="96" height="48" x="-48" y="-24" rx="15" ry="15" fill="#1aaee5" stroke="#fff" stroke-width="1" />\n\t\t<text data-key="text" y="0" x="${zt(a)}" style="pointer-events: none;" fill="#fff">&nbsp;</text>`,c=yt(i,a,s,{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:24}},top:{dir:"top",position:{x:0,y:-24}}},(t=>{const n=t.getBBox(),e=p(96,48,n.width+(a.t?6:0)),o=p(48,48,n.height);a.w===e&&a.h===o||(a.w=e,a.h=o,l())}),a.t?bt:mt);e(c.el,a.t?"shtxt":"shrect");let r=a.w,d=a.a;function l(i){const s=a.w/-2,l=a.h/-2;c.cons.right.position.x=-s,c.cons.left.position.x=s,c.cons.bottom.position.y=-l,c.cons.bottom.position.x=0,c.cons.top.position.y=l,c.cons.top.position.x=0;for(const e in c.cons)n(t(c.el,e),c.cons[e].position);if(Ht(c.el,"main",a.w,a.h,s,l),Ht(c.el,"outer",a.w+48,a.h+48,s-24,l-24),i||d!==a.a||r!==a.w){let n,i;switch(a.a){case 1:n=s+8,i=(a.w-r)/2;break;case 2:n=0,i=0;break;case 3:n=-s-8,i=(a.w-r)/-2}const l=t(c.el,"text");l.x.baseVal[0].value=n,l.querySelectorAll("tspan").forEach((t=>{t.x.baseVal[0].value=n})),a.position.x+=i,o(c.el,`ta-${d}`),e(c.el,`ta-${a.a}`),d=a.a,r=a.w}c.draw()}return e(c.el,`ta-${a.a}`),96!==a.w||48!==a.h?l(!0):c.draw(),c.el[O].draw=l,c.el}function Ht(n,e,o,i,a,s){const c=t(n,e);c.width.baseVal.value=o,c.height.baseVal.value=i,c.x.baseVal.value=a,c.y.baseVal.value=s}customElements.define("ap-rect-txt-settings",$t);const zt=t=>1===t.a?-40:2===t.a?0:40;function Lt(o,i){const a=yt(o,i,'<path data-key="outer" data-evt-no data-evt-index="2" d="M-72 0 L0 -72 L72 0 L0 72 Z" stroke-width="0" fill="transparent"/><path data-key="border" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="20" stroke="#fff" fill="transparent" stroke-linejoin="round"/><path data-key="main" d="M-39 0 L0 -39 L39 0 L0 39 Z" stroke-width="18" stroke-linejoin="round" stroke="#1D809F" fill="#1D809F"/><text data-key="text" x="0" y="0" text-anchor="middle" style="pointer-events:none" fill="#fff"> </text>',{right:{dir:"right",position:{x:48,y:0}},left:{dir:"left",position:{x:-48,y:0}},bottom:{dir:"bottom",position:{x:0,y:48}},top:{dir:"top",position:{x:0,y:-48}}},(t=>{const n=p(96,48,function(t){const n=h(t);return 2*(Math.abs(n.x)+Math.abs(n.y))}(t)-20);n!==i.w&&(i.w=n,s())}));function s(){const e=Vt(i.w,0);a.cons.right.position.x=e.r.x,a.cons.left.position.x=e.l.x,a.cons.bottom.position.y=e.b.y,a.cons.top.position.y=e.t.y;for(const e in a.cons)n(t(a.el,e),a.cons[e].position);const o=Vt(i.w,9);Et(a.el,"main",o),Et(a.el,"border",o),Et(a.el,"outer",Vt(i.w,-24)),a.draw()}return e(a.el,"shrhomb"),i.w&&96!==i.w?s():a.draw(),a.el}function Et(n,e,o){t(n,e).setAttribute("d",`M${o.l.x} ${o.l.y} L${o.t.x} ${o.t.y} L${o.r.x} ${o.r.y} L${o.b.x} ${o.b.y} Z`)}function Vt(t,n){const e=t/2,o=n-e,i=e-n;return{l:{x:o,y:0},t:{x:0,y:o},r:{x:i,y:0},b:{x:0,y:i}}}class Bt extends HTMLElement{connectedCallback(){const t=this.attachShadow({mode:"closed"});t.innerHTML='<style>.menu{overflow-x:auto;padding:0;position:fixed;top:50%;left:5px;transform:translateY(-50%);box-shadow:0 0 58px 2px rgba(34,60,80,.2);border-radius:16px;background-color:rgba(255,255,255,.9)}.content{white-space:nowrap;display:flex;flex-direction:column}[data-cmd]{cursor:pointer}.menu svg{padding:10px}.stroke{stroke:#344767;stroke-width:2px;fill:transparent}.menu .big{width:62px;min-width:62px}@media only screen and (max-width:700px){.menu{width:100%;border-radius:0;bottom:0;display:flex;flex-direction:column;top:unset;left:unset;transform:unset}.content{align-self:center;flex-direction:row}}</style><div id="menu" class="menu" style="touch-action:none"><div class="content"><svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="1" viewBox="0 0 24 24" width="24" height="24"><circle r="9" cx="12" cy="12"></circle></svg> <svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="4" viewBox="0 0 24 24" width="24" height="24"><path d="M2 12 L12 2 L22 12 L12 22 Z" stroke-linejoin="round"></path></svg> <svg class="stroke" data-cmd="shapeAdd" data-cmd-arg="2" viewBox="0 0 24 24" width="24" height="24"><rect x="2" y="4" width="20" height="16" rx="3" ry="3"></rect></svg> <svg data-cmd="shapeAdd" data-cmd-arg="0" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13 8v8a3 3 0 0 1-3 3H7.83a3.001 3.001 0 1 1 0-2H10a1 1 0 0 0 1-1V8a3 3 0 0 1 3-3h3V2l5 4-5 4V7h-3a1 1 0 0 0-1 1z" fill="rgba(52,71,103,1)"/></svg> <svg data-cmd="shapeAdd" data-cmd-arg="3" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M13 6v15h-2V6H5V4h14v2z" fill="rgba(52,71,103,1)"/></svg></div></div>';const n=t.getElementById("menu");n.querySelectorAll('[data-cmd="shapeAdd"]').forEach((t=>s(t,"pointerdown",this))),s(n,"pointerleave",this),s(n,"pointerup",this),s(n,"pointermove",this)}init(t){this.u=t}handleEvent(t){switch(t.type){case"pointermove":if(!this.g){const n=document.elementFromPoint(t.clientX,t.clientY);if(n===this.$)return;this.M===this.$&&this.u.ownerSVGElement.setPointerCapture(t.pointerId),this.$=n}break;case"pointerleave":this.g=!0,null!=this.H&&this.L(t),this.V();break;case"pointerdown":this.H=parseInt(t.currentTarget.getAttribute("data-cmd-arg")),this.M=document.elementFromPoint(t.clientX,t.clientY),this.$=this.M,this.g=null;break;case"pointerup":this.V()}}L(t){A(!1);const n=H(this.u[y].data,t.clientX,t.clientY),e=0===this.H?{s:{data:{dir:"right",position:{x:n.x-24,y:n.y}}},e:{data:{dir:"right",position:{x:n.x+24,y:n.y}}}}:{type:this.H,position:{x:n.x,y:n.y},title:"Title"},o=this.u[y].shapeMap[this.H].create(e);this.u.append(o),o.dispatchEvent(new PointerEvent("pointerdown",t))}V(){this.H=null,this.M=null,this.$=null}}customElements.define("ap-menu-shape",Bt);const St=document.getElementById("canvas");St[y]={data:{position:{x:0,y:0},scale:1,cell:24},shapeMap:function(t){return{0:{create:n=>st(t,n)},1:{create:n=>wt(t,n)},2:{create:n=>Mt(t,n)},3:{create:n=>(n.t=!0,Mt(t,n))},4:{create:n=>Lt(t,n)}}}(St)},function(t){let n,e,o;function i(t){t.isPrimary&&t.isTrusted&&(n&&Math.abs(n.x-t.clientX)<3&&Math.abs(n.y-t.clientY)<3?t.stopImmediatePropagation():(n=null,void 0===t.movementX?(t[g]=e?t.clientX-e:0,t[x]=o?t.clientY-o:0,e=t.clientX,o=t.clientY):(t[g]=t.movementX,t[x]=t.movementY)))}t.addEventListener("pointerdown",(a=>{n={x:a.clientX,y:a.clientY},e=null,o=null,t.addEventListener("pointermove",i,{capture:!0,passive:!0}),t.addEventListener("pointerup",(n=>{c(t,"pointermove",i,!0)}),{capture:!0,once:!0,passive:!0})}),{capture:!0,passive:!0})}(St.ownerSVGElement),St.ownerSVGElement.addEventListener("pointerdown",(t=>{if(!t.isPrimary||t[S]||!t.isTrusted)return;t.stopImmediatePropagation();const n=new PointerEvent("pointerdown",t);n[S]=!0,function(t){return B(t).find((t=>!t.hasAttribute("data-evt-no")))}(t).dispatchEvent(n)}),{capture:!0,passive:!0}),function(t){s(document,"paste",(n=>{if("TEXTAREA"===n.target.tagName.toUpperCase())return;const e=n.clipboardData.getData(Y);e&&(A(!1),j(t),W(t,JSON.parse(e)))}))}(St),function(t){const o=t.ownerSVGElement;let i,a,r,d,h;function u(t){if(t[M]||!d)return void f();t[M]=!0,r&&(r.remove(),r=null);const n=t.clientX-a.x,e=t.clientY-a.y;d.width.baseVal.value=Math.abs(n),d.height.baseVal.value=Math.abs(e),n<0&&(h.x=t.clientX),e<0&&(h.y=t.clientY),d.style.transform=`translate(${h.x}px, ${h.y}px)`}function p(){if(d){const n=n=>it(H(t[y].data,h.x,h.y),d.width.baseVal.value/t[y].data.scale,d.height.baseVal.value/t[y].data.scale,n.x,n.y);nt(t,t.children,n)}f()}function f(){clearTimeout(i),i=null,r?.remove(),r=null,d?.remove(),d=null,c(o,"pointermove",u),c(o,"wheel",f),c(o,"pointerup",p)}s(o,"pointerdown",(c=>{!c[M]&&c.isPrimary?(s(o,"pointermove",u),s(o,"wheel",f,!0),s(o,"pointerup",p,!0),i=setTimeout((i=>{j(t),r=l("circle"),e(r,"ative-elem"),r.style.cssText="r:10px; fill: rgb(108 187 247 / 51%)",n(r,{x:c.clientX,y:c.clientY}),o.append(r),a={x:c.clientX,y:c.clientY},h={x:c.clientX,y:c.clientY},d=l("rect"),d.style.cssText="rx:10px; fill: rgb(108 187 247 / 51%)",n(d,h),o.append(d)}),500)):f()}))}(St),function(t){const n=t[y].data,e=function(t,n){let e;function o(n){e!==n&&(e=n,t.style.backgroundImage=`radial-gradient(rgb(73 80 87 / ${n}) 1px, transparent 0)`)}return o(.7),t.style.backgroundSize=`${n.cell}px ${n.cell}px`,function(){const e=n.cell*n.scale;n.scale<.5?o(0):n.scale<=.9?o(.3):o(.7),t.style.backgroundSize=`${e}px ${e}px`,t.style.backgroundPosition=`${n.position.x}px ${n.position.y}px`}}(t.ownerSVGElement,n);function o(){t.style.transform=`matrix(${n.scale}, 0, 0, ${n.scale}, ${n.position.x}, ${n.position.y})`,e()}function i(t,e){if(t<.25||t>4)return;const i=t/n.scale;n.scale=t,n.position.x=i*(n.position.x-e.x)+e.x,n.position.y=i*(n.position.y-e.y)+e.y,o()}!function(t,n,e,o){let i,a,r,d;function l(n){r=null,d=null,i?.id===n.pointerId&&(i=null),a?.id===n.pointerId&&(a=null),i||a||(c(t,"pointermove",h),c(t,"pointercancel",l),c(t,"pointerup",l))}function h(t){if(t[M])return;if(i&&!a||!i&&a)return n.position.x=t.clientX+(i||a).shift.x,n.position.y=t.clientY+(i||a).shift.y,void o();if(!a||!i||a?.id!==t.pointerId&&i?.id!==t.pointerId)return;const s=Math.hypot(i.pos.x-a.pos.x,i.pos.y-a.pos.y),c={x:(i.pos.x+a.pos.x)/2,y:(i.pos.y+a.pos.y)/2};r&&(n.position.x=n.position.x+c.x-d.x,n.position.y=n.position.y+c.y-d.y,e(n.scale/r*s,c)),r=s,d=c,i.id===t.pointerId&&(i=E(t,n)),a.id===t.pointerId&&(a=E(t,n))}s(t,"pointerdown",(e=>{e[M]||!i&&!e.isPrimary||i&&a||(t.setPointerCapture(e.pointerId),i||(s(t,"pointermove",h),s(t,"pointercancel",l),s(t,"pointerup",l)),i?a||(a=E(e,n)):i=E(e,n))}))}(t.ownerSVGElement,n,i,o),t.ownerSVGElement.addEventListener("wheel",(t=>{t.preventDefault();const e=t.deltaY||t.deltaX,o=Math.abs(e)<50?.05:.25;i(n.scale+(e<0?o:-o),L(t))})),t[y].move=function(t,e,i){n.position.x=t,n.position.y=e,n.scale=i,o()}}(St),document.getElementById("menu-shape").init(St);let Ct=new URL(window.location.href);Ct.searchParams.get("k")?(P(!0),async function(t){return(await fetch(`https://dgrm.boyko.tech/api/${t}`)).json()}(Ct.searchParams.get("k")).then((t=>{Ct.searchParams.delete("k"),Z(St,t)&&A(!1),history.replaceState(null,null,Ct),P(!1),Ct=null}))):Ct=null}();
